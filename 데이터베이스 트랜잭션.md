# 데이터베이스 트랜잭션 :desert_island:



## 트랜잭션이 뭘까?

인가받지 않은 사용자로부터 데이터를 보장하기 위해 DBMS가 가져야 하는 특성이자, 데이터베이스 시스템에서 하나의 논리적 기능을 정상적으로 수행하기 위한 작업의 기본 단위이다.

간단하게 이야기해서, **데이터베이스의 상태를 변화시키기 위해 수행하는 작업의 단위**이다.

- 여기서 '작업의 단위'란 한꺼번에 모두 수행되는 일련의 연산을 의미한다.
- 예를 들어, 사용자가 게시글을 작성하고 그 게시글을 확인하기까지 사용되는 SQL문들을 '작업의 단위'라고 할 수 있겠다.

정리하자면, **데이터베이스 트랜잭션**(Database Transaction)은 데이터베이스 관리 시스템 또는 유사한  시스템에서 상호작용의 단위이다. 여기서 유사한 시스템이란 트랜잭션이 성공과 실패가 분명하고 상호 독립적이며, 일관되고 믿을 수 있는 시스템을 의미한다.

이론적으로 데이터베이스 시스템은 각각의 트랜잭션에 대해 원자성(Atomicity), 일관성(Consistency), 독립성(Isolation), 영구성(Durability)을 보장한다. 이 성질을 첫글자를 따 ACID라 부른다. 그러나, 실제로는 성능향상을 위해 이런 특성들이 종종 완화되곤 한다.

아래에서 이러한 트랜잭션의 특징들에 대해 좀 더 자세히 알아보자.





## 트랜잭션의 특징

트랜잭션의 특징은 크게 4가지로 구분된다.



- 원자성 (Atomicity)
- 일관성 (Consistency)
- 독립성 (Isolation)
- 지속성 (Durability)



원자성이란, 트랜잭션이 데이터베이스에 모두 반영되던가, 아니면 전혀 반영되지 않아야 한다는 것이다. 즉, **일부의 트랜잭션을 반영하는 경우는 없어야 한다는 뜻이다.** 만일 원자성이 지켜지지 않는다면, 오작동 시 원인을 찾아내기가 어려워지고, 데이터 처리 시스템을 이해하기도 어려워질 것이다.

일관성이란, 트랜잭션의 작업 처리 **결과에는 항상 일관성**이 있어야 한다는 뜻이다. 트랜잭션이 진행되는 동안에 데이터베이스가 변경되더라도 업데이트된 데이터베이스로 트랜잭션이 진행되는 것이 아니라, 처음에 트랜잭션을 진행하기위해 참조한 데이터베이스로 진행한다. 이렇게 함으로써 각 사용자는 **일관성 있는 데이터**를 볼 수 있게 된다.

독립성이란, 둘 이상의 트랜잭션이 동시에 실행되고 있을 경우 어떤 하나의 트랜잭션이라도 **다른 트랜잭션의 연산에 끼어들 수 없다**는 뜻이다. 하나의 특정 트랜잭션이 완료될 때까지 다른 트랜잭션이 특정 트랜잭션의 결과를 참조할 수 없다.

지속성이란, 트랜잭션이 성공적으로 완료되었을 경우 **결과가 영구적으로 반영되어야 한다**는 뜻이다.

그렇다면 트랜잭션은 왜 쓰는 것일까?





## 트랜잭션의 목적

트랜잭션은 데이터의 일관성을 유지하면서 안정적으로 데이터를 복구하기 위해 사용한다. 데이터베이스에서는 테이블에서 데이터를 읽어온 후 다른 테이블에 데이터를 입력하거나 갱신, 삭제하는 데 처리 도중 오류가 발생하면 **모든 작업을 원상태로 되돌린다.** 처리 과정이 모두 성공했을 때에만 최종적으로 데이터베이스에 반영한다.

즉, 예상하지 못한 상황에서 오류가 발생하여 데이터의 부정합이 발생하는 경우, 다시 원상복귀하기 위해 사용한다고 정리할 수 있겠다.

이를 위해 트랜잭션은 연산을 사용하고, 단계에 따른 상태를 가진다.





## 트랜잭션의 연산과 상태

- Commit 연산

Commit 연산은 한개의 논리적 단위(트랜잭션)에 대한 작업이 성공적으로 끝났고 데이터베이스가 다시 일관된 상태에 있을 때, 이 트랜잭션이 행한 갱신 연산이 완료된 것을 트랜잭션 관리자에게 알려주는 연산이다.

- Rollback 연산

Rollback 연산은 하나의 트랜잭션 처리가 비정상적으로 종료되어 데이터베이스의 일관성을 깨트렸을 때, 이 트랜잭션의 일부가 정상적으로 처리되었더라도 트랜잭션의 원자성을 구현하기 위해 이 트랜잭션이 행한 모든 연산을 취소(Un do)하는 연산이다. Rollback 시에는 해당 트랜잭션을 재시작하거나 폐기한다.

- 트랜잭션의 상태
  - 활동(Active) : 트랜잭션이 실행중인 상태
  - 실패(Failed) : 트랜잭션 실행에 오류가 발생하여 중단된 상태
  - 철회(Aborted) : 트랜잭션이 비정상적으로 종료되어 Rollback 연산을 수행한 상태
  - 부분 완료(Partially Committed) : 트랜잭션의 마지막 연산까지 실행했지만, Commit 연산이 실행되기 직전의 상태
  - 완료 (Committed) : 트랜잭션이 성공적으로 종료되어 Commit 연산을 실행한 후의 상태
